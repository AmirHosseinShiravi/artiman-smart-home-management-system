rtu.mgm.ui.showLicenseManagement = function () { var e = rtu.ia.prepareMainContentArea(), n = document.createElement("div"); e.appendChild(n), $(n).load("/rtui/app/mgm/ui/licensemanagement.cd2cb7f105.html #RTU_MGM_LICENSEMANAGEMENT", function () { rtu.mgm.ia.initLicenseManagement() }) };
rtu.mgm.ia.initSplitterArea(), rtu.global.configManagementGrid = null, rtu.global.localManagementGrid = null; document.getElementsByName(rtu.global.RTU_CONFIGGRID); rtu.mgm.ia.loadLicenseData(), rtu.mgm.ia.displayLocalLicenseData(); var e = document.getElementById("RTU_MGM_DROPZONE"); e.addEventListener("dragstart", rtu.mgm.ia.handleDragStart, !1), e.addEventListener("dragenter", rtu.mgm.ia.handleDragEnter, !1), e.addEventListener("dragleave", rtu.mgm.ia.handleDragEnd, !1), e.addEventListener("dragover", rtu.mgm.ia.handleDragOver, !1), e.addEventListener("drop", function (e) { var t = function (e) { rtu.mgm.ia.updateLocalLicenseData(e) }; rtu.mgm.ia.handleFileSelect(e, t) }, !1), RT.translateAll(), $(window).trigger("resize") }, rtu.mgm.ia.loadLicenseData = function () { var e = function (e) { rtu.mgm.ia.displayErrorMessage(e), rtu.util.closeWaitingPopupWindow() }; rtu.mgm.ia.loadFileData("/service/rtu/runtime/v1/files", rtu.mgm.ia.displayLicenseData, e) }, rtu.mgm.ia.getLicenseGridColumns = function (e) { var t = []; return t.push({ text: _("UI_MGM_COLTEXT_SERIALNUM"), datafield: "serialnumber", width: 200 }), t.push({ text: _("UI_MGM_COLTEXT_EXPDATE"), datafield: "expirationtime", width: 200 }), t.push({ text: _("UI_MGM_COLTEXT_MAXNO_DATPOIUNTS"), datafield: "maxnoofdatapoints", width: 200, cellsalign: "right" }), t }, rtu.mgm.ia.licensedescrenderer = function (e, t, a, i) { if (a && "" != a) { var r = a.split("<br").length, n = "row" + e + i, e = document.getElementById(n); return e && (e.style.height = 8 + 18 * r + "px"), '<div class="MGM_CELL_FEATURES">' + a + "</div>" } }, rtu.mgm.ia.remotelicensedescrenderer = function (e, t, a) { rtu.mgm.ia.licensedescrenderer(e, t, a, rtu.global.RTU_LICENSEGRID) }, rtu.mgm.ia.locallicensedescrenderer = function (e, t, a) { rtu.mgm.ia.licensedescrenderer(e, t, a, "RTU_MGM_LOCALGRID") }, rtu.mgm.ia.getLicenseDatafields = function () { var e = [{ name: "serialnumber", type: "string" }, { name: "expirationtime", type: "string" }, { name: "maxnoofdatapoints", type: "string" }, { name: "licensedesc", type: "string" }, { name: "rtufiletype", type: "string" }]; return e }, rtu.mgm.ia.displayLicenseData = function (e) { function t(e, t) { $.each(e.childNodes, function () { switch (this.nodeName.toLowerCase()) { case "name": t.localfilename = this.textContent; break; case "serialnumber": t.serialnumber = this.textContent; break; case "expirationtime": t.expirationtime = this.textContent; break; case "maxnoofdatapoints": t.maxnoofdatapoints = this.textContent; break; case "licensedesc": t.licensedesc ? t.licensedesc = t.licensedesc + "<br />" + this.textContent : t.licensedesc = this.textContent } }) } function a(e) { for (var a, i = new Array, r = 0, n = e.getElementsByTagName("file"), l = 0; a = n[l]; l++) { var o = a.getAttribute("type"); if ("LIC" == o) { var s = (a.getElementsByTagName("stored"), a.getElementsByTagName("actual")); if (s.length > 0) { var d = s[0], m = {}; m.rtufiletype = o, m.showdelete = !1, m.showdownload = !0, m.showaction = "", t(d, m), i[r] = m, r++ } } } return i } var i = a(e), r = "#" + rtu.global.RTU_LICENSEGRID, n = rtu.mgm.ia.getLicenseDatafields(), l = rtu.mgm.ia.getLicenseGridColumns(r); if (l.push({ text: _("UI_MGM_COLTEXT_FEATURES"), datafield: "licensedesc", width: 200, cellsalign: "right" }), rtu.global.configManagementGrid) { var o = rtu.global.configManagementGrid; o.updateGrid(i) } else { var o = new rtu.mgm.ia.ManagementGrid(r, rtu.mgm.om.GRIDTYPE_LICENSE_MGM, i, n, l, null, null, (!0)); rtu.global.configManagementGrid = o } }, rtu.mgm.ia.displayLocalLicenseData = function () { var e = new Array, t = {}; e[0] = t; var a = "#RTU_MGM_LOCALGRID", i = rtu.mgm.ia.getLicenseDatafields(), r = rtu.mgm.ia.getLicenseGridColumns(a); if (r.push({ text: _("UI_MGM_COLTEXT_FEATURES"), datafield: "licensedesc", width: 200, cellsalign: "right" }), rtu.global.localManagementGrid) { var n = rtu.global.localManagementGrid; n.updateGrid(e) } else { var n = new rtu.mgm.ia.ManagementGrid(a, rtu.mgm.om.GRIDTYPE_LICENSE_MGM, e, i, r, rtu.mgm.ia.clearLocalConfigData, null, (!1)); rtu.global.localManagementGrid = n, $("#RTU_MGM_LOCALGRID").jqxGrid({ autorowheight: !1 }); $("#RTU_MGM_LOCALGRID").jqxGrid({ rowsheight: 30 }) } }, rtu.mgm.ia.updateLocalLicenseData = function (e) { if (e && e.length > 0) { var t = function (e, t) { $("#RTU_MGM_LOCALGRID").jqxGrid({ autorowheight: !0 }), rtu.mgm.ia.showLocalLicenseData(e, t); var a = $("#RTU_MGM_LOCALGRID").jqxGrid("rowsheight"); $("#RTU_MGM_LOCALGRID").jqxGrid({ autorowheight: !1 }); $("#RTU_MGM_LOCALGRID").jqxGrid({ rowsheight: a }) }; rtu.mgm.ia.getFileDetails(e[0], t, rtu.mgm.om.GRIDTYPE_LICENSE_MGM) } }, rtu.mgm.ia.showLocalLicenseData = function (e, t) { if (!t || 0 == t.length || t.fileType != rtu.mgm.ia.fileType.LICENSE) return void rtu.util.showNotificationE(_("UI_MGM_INVALID_FILETYPE")); var a = (e.name, 0), i = $("#RTU_MGM_LOCALGRID").jqxGrid("getdatainformation").rowscount, r = {}; if (r.showdelete = !0, r.showaction = "", r.showupload = !0, r.serialnumber = t.serialnumber, r.expirationtime = t.expirationtime, r.maxnoofdatapoints = t.maxnoofdatapoints, r.licensedesc = t.licensedesc, r.state = "", r.fileobject = e, r.rtufiletype = "LIC", a >= 0 && a < i) { var n = $("#RTU_MGM_LOCALGRID").jqxGrid("getrowid", a); $("#RTU_MGM_LOCALGRID").jqxGrid("updaterow", n, r); $("#RTU_MGM_LOCALGRID").jqxGrid("ensurerowvisible", a) } r.showupload = !0 }, rtu.mgm.ia.clearLocalLicenseData = function (e) { var t = $("#RTU_MGM_LOCALGRID").jqxGrid("selectedrowindexes"), a = []; if (t.length > 0) for (var i = 0; i < t.length; i++) { var r = $("#RTU_MGM_LOCALGRID").jqxGrid("getrowid", t[i]); a.push(r) } else { var r = $("#RTU_MGM_LOCALGRID").jqxGrid("getrowid", e.args.rowindex); a.push(r) } if (a.length > 0) { $("#RTU_MGM_LOCALGRID").jqxGrid("deleterow", a); $("#RTU_MGM_FILEOPEN").val("") } var n = $("#RTU_MGM_LOCALGRID").jqxGrid("getdatainformation").rowscount; if (0 == n) { var l = {}; l.showdelete = !1, l.showaction = "", l.showupload = !1, l.serialnumber = "", l.expirationtime = "", l.maxnoofdatapoints = "", l.licensedesc = "", l.state = "", l.fileobject = null; $("#RTU_MGM_LOCALGRID").jqxGrid("addrow", null, l) }
